<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostics - SERPENT Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">SERPENT Diagnostics - {{ role|upper }}</span>
            <div class="d-flex">
                <a href="/" class="btn btn-outline-light btn-sm me-2">Dashboard</a>
                <a href="/logs" class="btn btn-outline-light btn-sm me-2">Logs</a>
                <a href="/diagnostics" class="btn btn-outline-light btn-sm">Diagnostics</a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-3">
        <!-- Issue Detection -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Detected Issues</h5>
                        <button id="check-issues-btn" class="btn btn-primary btn-sm mb-3">Check for Issues</button>
                        <div id="issues-display">
                            <div class="text-muted">Click "Check for Issues" to scan for problems</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Network Tests -->
        <div class="row mb-3">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Network Tests</h5>
                        <button id="network-test-btn" class="btn btn-primary btn-sm mb-3">Run Network Tests</button>
                        <div id="network-results">
                            <div class="text-muted">Click "Run Network Tests" to check connectivity</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Camera Scan -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Camera Scan</h5>
                        <button id="camera-scan-btn" class="btn btn-primary btn-sm mb-3">Scan Cameras</button>
                        <div id="camera-results">
                            <div class="text-muted">Click "Scan Cameras" to detect video devices</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Service Status -->
        <div class="row mb-3">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Service Status</h5>
                        <button id="service-check-btn" class="btn btn-primary btn-sm mb-3">Check Services</button>
                        <div id="service-results">
                            <div class="text-muted">Click "Check Services" to view systemd status</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Resources -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">System Resources</h5>
                        <button id="resources-check-btn" class="btn btn-primary btn-sm mb-3">Check Resources</button>
                        <div id="resources-results">
                            <div class="text-muted">Click "Check Resources" to view system usage</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Service Control (if enabled) -->
        {% if service_control_enabled %}
        <div class="row mb-3">
            <div class="col-12">
                <div class="card border-warning">
                    <div class="card-body">
                        <h5 class="card-title text-warning">Service Control</h5>
                        <p class="text-muted">Restart systemd services (requires sudo permissions)</p>
                        <button class="btn btn-warning btn-sm" onclick="restartService('serpent-robot-bridge.service')">
                            Restart Robot Bridge
                        </button>
                        <button class="btn btn-warning btn-sm" onclick="restartService('serpent-base-bridge.service')">
                            Restart Base Bridge
                        </button>
                        <button class="btn btn-warning btn-sm" onclick="restartService('serpent-backend.service')">
                            Restart Backend
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/diagnostics.js') }}"></script>
</body>
</html>
